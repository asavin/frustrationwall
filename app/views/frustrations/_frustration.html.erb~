<div class="frust-item">
    <div class="frust-main-container">
        <div class="frust-love-bubble" id="frust-love-bubble-<%= frustration.id %>">
            <%= image_tag('little_heart.png', :class => 'love-bubble-icon') %>
            <span class="love-bubble-count" id="love-bubble-count-<%= frustration.id %>"><%= frustration.love %></span>
        </div>
        <div class="frust-content">
            <span><%= frustration.content %></span>
            <div class="time-ago"><%= link_to time_ago_in_words(frustration.created_at) + ' ago', frustration %></div>
        </div>
        <div class="big-love" id="big-love-<%= frustration.id %>">
            <%= image_tag('heart_grey.png') %>
        </div>
        <div class="frust-actions">
            <a href="#" id="frust-love-action-<%= frustration.id %>"><span class="frust-love-action"></span></a>
            <a href="#"><span class="frust-comment-action"></span></a>
        </div>
    </div>
    <script>
        $('#frust-love-action-<%= frustration.id %>').click(function(e){
            e.preventDefault();
            $('#frust-love-bubble-<%= frustration.id %>').show();
            count = parseInt($('#love-bubble-count-<%= frustration.id %>').text(), 10) + 1
            $('#love-bubble-count-<%= frustration.id %>').text(count)
            $('#big-love-<%= frustration.id %>').fadeIn().delay(300).fadeOut();
            $.getJSON("<%= add_love_path(:id => frustration.id) %>", {}, 
                function(data) {
                    // let's update the progress bar based on the server response
                    if(data < 34) {
                        percents = data + '%';
                        $('#green-progress-bar-part').css('width', percents);
                    } else if(data < 67) {
                        percents = data - 33 + '%';
                        $('#yellow-progress-bar-part').css('width', percents);
                    } else if(data < 101) {
                        percents = data - 66 + '%';
                        $('#red-progress-bar-part').css('width', percents);
                    }
                }
            
            );
        });
        <% if frustration.love > 0 %>
            $(document).ready(function(){
                $('#frust-love-bubble-<%= frustration.id %>').fadeIn('slow');
            });
        <% end %>
    </script>
</div>
